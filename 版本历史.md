# TIMSDK

## 最新版本 4.3.135 @2019.05.24

**iOS平台**

- 增加校验好友接口 checkFriends
- 增加 queryGroupInfo 接口获取本地数据
- 废弃 getGroupPublicInfo 接口，统一用 getGroupInfo 接口
- 修复消息列表包含已删除消息的问题
- 修复未登陆获取不了本地消息问题
- 修复最近联系人拉取数量及排序问题
- 修复群消息断网重连后的消息同步问题
- 修复短时间内接收大量消息时判重失效问题
- 修复重启程序后有概率再次收到同一条消息的问题
- 修复初始化和同步消息偶现异常问题
- 修复会话的 lastMsg 被删除引发的偶现异常问题
- 修复登录后 onRefreshConversation 回调两次且数据相同问题
- 修复 chatroom 获取不了入群前的历史消息问题
- 修复 TIMMessage 的 copyFrom 接口不生效的问题
- 修复 TIMGroupEventListener 监听收不到回调的问题
- 修复线上反馈的 Crash 问题
- 优化重连时连接请求
- 优化在不同网络下首次连接和海外接入点的质量
- 优化iOS切换WIFI时网络重连慢的问题


**Android平台**

- 增加校验好友接口 checkFriends
- 增加 queryGroupInfo 接口获取本地数据
- 废弃 getGroupDetailInfo 和 getGroupPublicInfo 接口，统一用 getGroupInfo 接口
- 修复消息列表包含已删除消息的问题
- 优化 modifyGroupOwner 和 getGroupMembersByFilter 回调问题
- 修复未登陆获取不了本地消息问题
- 修复最近联系人拉取数量及排序问题
- 修复群消息断网重连后的消息同步问题
- 修复短时间内接收大量消息时判重失效问题
- 修复重启程序后有概率再次收到同一条消息的问题
- 修复初始化和同步消息偶现异常问题
- 修复会话的 lastMsg 被删除引发的偶现异常问题
- 修复登录后 onRefreshConversation 回调两次且数据相同问题
- 修复 chatroom 获取不了入群前的历史消息问题
- 修复线上反馈的 Crash 问题
- 优化重连时连接请求
- 优化在不同网络下首次连接和海外接入点的质量



**Windows平台**

- 新增自定义字段数据上报
- 新增阅后即焚消息
- 新增消息撤回使用用例
- 修复设置上传文件偶现失败问题
- 修复消息列表包含已删除消息的问题
- 修复最近联系人拉取数量及排序问题
- 修复群消息断网重连后的消息同步问题
- 修复短时间内接收大量消息时判重失效问题
- 修复重启程序后有概率再次收到同一条消息的问题
- 修复会话的 lastMsg 被删除引发的偶现异常问题
- 修复初始化和同步消息偶现异常问题
- 发送消息，在发送成功的回调里面返回消息的json字符串
- TIMSetRecvNewMsgCallback 接口改为 TIMAddRecvNewMsgCallback 和 TIMRemoveRecvNewMsgCallback 接口
- 新增socks5代理服务器配置
- 优化重连时连接请求
- 优化在不同网络下首次连接和海外接入点的质量



## 4.3.118 @2019.05.10

**iOS平台**

- 增加 TIMFriendshipManager 类中的 querySelfProfile 和 queryUserProfile 接口（读取本地数据）
- 修复获取登录 getLoginUser 返回登录用户异常的问题
- 修复线上反馈的用户资料获取失败问题
- 修复重启 APP 后部分本地字段失效问题
- 修复消息删除后调用已读上报偶现异常的问题
- 修复线上反馈的 IM 群组问题
- 修复会话未读数问题
- 修复在线消息问题
- 修复消息重发偶现失效问题
- 修复本地票据过期导致持续重连问题
- 修复线上反馈的 Crash 问题
- 优化服务器连接策略
- 优化断网重连策略
- 优化服务器过载策略
- 优化心跳，减少不必要发包
- TUIKit 新增支持 CocoaPods 导入
- TUIKit 新增联系人界面
- TUIKit 新增好友添加界面
- TUIKit 新增黑名单界面
- TUIKit 新增好友搜索界面
- TUIKit 新增新朋友界面
- TUIKit 优化好友资料页：增加备注、黑名单、删除好友功能
- TUIKit 优化个人资料页：增加昵称、个人签名、生日、性别、所在地修改功能
- TUIKit 优化群列表置顶功能

**Android平台**

- 增加 TIMFriendshipManager 类中的 querySelfProfile 和 queryUserProfile 接口（读取本地数据）
- 增加获取好友信息中 addTime 字段
- 增加 x86 及 x86_64 架构支持
- 修复获取登录 getLoginUser 返回登录用户异常的问题
- 修复线上反馈的用户资料获取失败问题
- 修复重启 APP 后部分本地字段失效问题
- 修复消息删除后调用已读上报偶现异常的问题
- 修复线上反馈的 IM 群组问题
- 修复会话未读数问题
- 修复在线消息问题
- 修复消息重发偶现失效问题
- 修复本地票据过期导致持续重连问题
- 修复线上反馈的 Crash 问题
- 优化服务器连接策略
- 优化断网重连策略
- 优化服务器过载策略
- 优化心跳，减少不必要发包
- TUIKit 加入聊天置顶功能
- TUIKit 修改昵称和个性签名，资料页面显示昵称
- TUIKit 修复 Android 端接收到 iOS 端发送的表情包后无法显示出来问题
- TUIKit 修复未读消息红点数问题
- TUIKit 修复美图 M8 设备点击加号后显示操作界面有 UI 问题
- TUIKit 修复设置头像后，头像会被缩小，不能铺满 UI 问题
- TUIKit 修复登录，自动登录逻辑
- TUIKit 修复超过输入内容最大限制后导致的 ANR 问题 
- TUIKit 修复发送图片, 当在相册选择图片并预览模式的时候，点击【确定】，发送会没有反应问题
- TUIKit 修复聊天界面长按图片消息没有弹出删除和撤销的操作按钮
- TUIKit 优化和修复线上反馈的 crash 问题

**Windows平台**

- 修复获取登录 getLoginUser 返回登录用户异常的问题
- 修复线上反馈的用户资料获取失败问题
- 修复重启 APP 后部分本地字段失效问题
- 修复消息删除后调用已读上报偶现异常的问题
- 修复线上反馈的 IM 群组问题
- 修复会话未读数问题
- 修复在线消息问题
- 修复消息重发偶现失效问题
- 修复本地票据过期导致持续重连问题
- 修复线上反馈的 Crash 问题
- 优化服务器连接策略
- 优化断网重连策略
- 优化服务器过载策略
- 优化心跳，减少不必要发包



## 4.3.81 @2019.04.24

**新功能**
- Android平台 补齐老版本 SDK 的好友黑名单功能，好友分组功能，以及加好友请求处理等关系链功能。

**iOS平台**
- 修复草稿箱添加消息元素crash的问题
- 修复某些账户在app卸载重装后拉取不到会话列表的问题
- 修复在登录的状态下usersig过期，不重启app的情况下会一直登录失败的问题
- 修复在登录的状态下usersig过期，发消息失败，收不到 usersig 过期回调的问题
- 修复修复群成员获取数量问题
- 优化请求超时（错误码6012）问题

**Android平台**
- 修复一处app主进程被杀后的报错问题
- 修复群成员获取数量问题
- 修复群自定义字段和群成员自定义字段的设置和获取问题
- 修复获取群信息超时后，没有onError回调出去的问题
- 修复某些账户在app卸载重装后拉取不到会话列表的问题
- 修复在登录的状态下usersig过期，不重启app的情况下会一直登录失败的问题
- 修复在登录的状态下usersig过期，发消息失败，收不到 usersig 过期回调的问题
- 修复消息乱序问题
- 优化请求超时（错误码6012）问题
- 更新关系链错误码
- TUIKit修复日期工具类出错的严重bug(github issue#75)
- TUIKit修改一处崩溃(github issue#86)
- TUIKit修复无权限时，使用SDK的一些问题
- TUIKit修复删除会话，删除消息，然后长按后的一些崩溃问题
- TUIKit修复popupwindow长驻不消失问题
- TUIKit修复消息重复问题
- TUIKit拦截发送空格空消息问题
- TUIKit修复删除会话后，未读消息未更新问题
- TUIKit修复发送消息最大字符限制问题
- TUIKit体验优化和修复若干数组越界问题

**Windows平台**
- 修复部分崩溃问题
- 优化请求超时（错误码6012）问题
- 修复某些账户在app卸载重装后拉取不到会话列表的问题
- 修复在登录的状态下usersig过期，不重启app的情况下会一直登录失败的问题
- 修复在登录的状态下usersig过期，发消息失败，收不到 usersig 过期回调的问题



## 4.2.52 @2019.04.17

**新功能**

- 补齐老版本 SDK 的好友黑名单功能，好友分组功能，以及加好友请求处理等关系链功能。

**iOS平台**
- 优化 API 接口注释
- 修复群自定义字段和群成员自定义字段不生效的问题
- 优化 TIMMessage 获取 senderProfile 拿不到用户资料信息的问题
- 修复已读回执回调及状态问题
- 修复同步未读消息最新一条消息不回调问题
- 修复群消息偶尔收不到问题
- 修复login回包无法解密问题
- 增加ip连接和login信息统计上报
- 修复消息seq错误

**Android平台**
- 修复android的jni泄漏
- 修复群组成员角色错误问题
- 修复退群在加群后，群组消息撤回崩溃问题
- 修复TUIKit Demo表情不显示问题
- 修复群聊会话获取消息，第二页大概率获取重复消息问题
- 修复TUIKit Demo中的部分crash问题
- 优化 TIMMessage 获取 senderProfile 拿不到用户资料信息的问题
- 修复已读回执回调及状态问题
- 修复同步未读消息最新一条消息不回调问题
- 修复群消息偶尔收不到问题
- 修复login回包无法解密问题
- 增加ip连接和login信息统计上报
- 修复消息seq错误

**Windows平台**
- 优化 TIMMessage 获取 senderProfile 拿不到用户资料信息的问题
- 修复已读回执回调及状态问题
- 修复同步未读消息最新一条消息不回调问题
- 修复群消息偶尔收不到问题
- 修复login回包无法解密问题
- 增加ip连接和login信息统计上报
- 修复消息seq错误



## 4.2.28 @2019.04.08

### iOS：

**bugfix：**

- 优化未读计数相关的问题
- 优化消息已读状态的问题
- 优化RESTAPI发的C2C消息排序异常的问题
- 优化获取漫游消息偶现重复的问题
- 优化uniqueId空实现的问题

### Android：

**新增：**

- 新增好友增/删/查逻辑


**bugfix：**

- 优化未读计数相关的问题

- 优化消息已读状态的问题
- 优化RESTAPI发的C2C消息排序异常的问题
- 优化获取漫游消息偶现重复的问题
- 优化uniqueId空实现的问题

### Windows：

**bugfix：**

- 优化未读计数相关的问题
- 优化消息已读状态的问题
- 优化RESTAPI发的C2C消息排序异常的问题
- 优化获取漫游消息偶现重复的问题

## 4.2.10 @2019.03.29

### iOS：
**新增：**

-    新增好友增/删/查逻辑


**bugfix：**

  - 优化超时问题
  - 优化自动登录逻辑
  - 优化crash问题
  - 优化偶现网络连接异常bug

### Android：

**bugfix：**

 - 优化超时问题
 - 优化自动登录逻辑
 - 优化JNI泄漏问题
 - 优化crash问题
 - 优化偶现网络连接异常bug

### Windows：

**bugfix：**

  - 优化超时问题
  - 优化crash问题
  - 优化偶现网络连接异常bug

## 4.2.9 @2019.03.27

### iOS & Mac：

**bugfix：**

- 修复ipv6环境下crash的问题
- 修复资料设置整数失败的问题

### Android：

**bugfix：**

- 修复资料设置整数失败的问题

## 4.2.1 @2019.03.15

### iOS:

- 调整项 优化后台解散群组, 客户端收不到相应指令的问题
- 修复项 调用 deleteConversationAndMessage() 无效
- 修复项 优化网络重新连接后收不到消息的问题 (现在网络重新连接后可以在会话界面主动请求拉取消息了)

### Android:

- 修复项 群组获取未决和已决信息返回不正确
- 修复项 客户端进入后台 Crash (现在 APP 进入后台不会直接 Crash 了)
- 修复项 优化网络重新连接后收不到消息的问题 (现在网络重新连接后可以在会话界面主动请求拉取消息了)
- 修复项 偶现消息排序错误
- 修复项 偶现消息发送失败

### WEB:

- 新增项 WEBIM 现已支持播放 .amr 的录音格式

### Windows:

- 新增项 /source-charset:.65001 编译选项
- 修复项 在文件系统直接运行 IMAPP.exe Crash 问题
- 修复项 部分编译出错, 以及 Crash 问题
- 移除项 X64 编译 (暂不支持)

## 4.0.13 @2019.03.13

### Android:

- 修复项 从 3.x 升级到 4.x 版本后登陆引起 Crash 的问题

### iOS:

- 新增项 支持 pod 直接集成 TUIKit.framework
- 修复项 从 3.x 升级到 4.x 版本后登陆引起 Crash 的问题

### Windows:

- 新增项 以 duilib 库为 UI 组件的 IM Demo
- 新增项 使用说明及相关集成指引文档

## 4.0.12 @2019.03.08
### Android:

- 修复项 群组禁言无效问题
- 修复项 修改用户群内身份功能
- 修复项 修改群消息接收选项
- 修复项 离线推送开关无效问题

### iOS:

- 新增项 TUIKit.framework 支持 bitcode 2
- 修复项 群组禁言无效问题
- 修复项 修改用户群内身份功能


## 4.0.10版本(Android端)

- 修复AVChatRoom进入房间超过100人之后收消息异常的问题

## 4.0.7版本

- 修复新老版本语音，文件，视频消息互通的问题
- 解决-5 tls exchange failed 卸载应用重新安装才能登录成功

## 4.0.6版本

- 解决userSig过期后重签仍然登陆失败问题

## 4.0.4版本

- 解决userSig过期后再次登录返回错误码不正确问题，应该返回6206；优化互踢逻辑

## 4.0.3版本

- 修复第三方离线推送问题
