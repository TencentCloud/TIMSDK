require("../../common/manifest.js")
require("../../debug/GenerateTestUserSig.js")
require("../../common/vendor.js")
global.webpackJsonpMpvue([16],{"9S7B":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("O2Sz"),o=s.n(i),a=s("VzEx");var n=function(t){s("yL8p")},r=s("ybqe")(o.a,a.a,n,"data-v-cd611ce0",null);e.default=r.exports},Bc9Z:function(t,e,s){"use strict";var i=a(s("5nAL")),o=a(s("9S7B"));function a(t){return t&&t.__esModule?t:{default:t}}i.default.config.errorHandler=function(t){console&&console.error&&console.error(t)},new i.default(o.default).$mount()},O2Sz:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(s("mvHQ")),o=r(s("Dd8w")),a=r(s("Bbwh")),n=s("NYxO");function r(t){return t&&t.__esModule?t:{default:t}}var c=-4,l=-5,m=-6,u=-7,d=-8,h=-9,g=-10;e.default={data:function(){return{args:{},closeFlag:!1,refuseFlag:!1,isPending:!0,isCalling:!1,frontCamera:!1,beauty:0,muted:!1,timeStamp:0,sdkAppID:0,userSig:"",userID:"",roomID:0,type:"",from:"",to:"",timeoutId:"",startTime:0}},computed:(0,o.default)({},(0,n.mapState)({rtcConfig:function(t){return t.global.rtcConfig}})),onShow:function(){var t=this,e=this.rtcConfig;this.userSig=e.userSig,this.sdkAppID=e.sdkAppID,this.userID=e.userID,this.isCalling=!1,this.isPending=!0,this.userID===this.from&&(this.timeoutId=setTimeout(function(){t.timeout()},6e4)),wx.setKeepScreenOn({keepScreenOn:!0}),this.$store.commit("setCalling",!0)},onUnload:function(){this.refuseFlag||this.closeFlag||(this.isCalling?this.closeRoom():"call"===this.type?this.closeRoom():this.refuse()),this.refuseFlag=!1,this.closeFlag=!1,this.isCalling=!1,this.isPending=!1,clearTimeout(this.timeoutId),this.$store.commit("setCalling",!1)},onHide:function(){this.isCalling=!1,this.isPending=!1,clearTimeout(this.timeoutId),this.closeRoom(),this.$store.commit("setCalling",!1),this.$bus.$off("onCall"),this.$bus.$off("isCalling"),this.$bus.$off("onClose"),this.$bus.$off("onRefuse"),this.$bus.$off("onBusy")},onLoad:function(t){var e=this;console.log(t),this.args=JSON.parse(t.args),this.userID=this.$store.getters.myInfo.userID,this.from=t.from,this.to=t.to,this.type=this.userID===this.from?"call":"onCall",this.roomID=this.args.room_id,this.$bus.$on("onCall",function(){e.isCalling=!0,e.isPending=!1,e.startTime=(new Date).getTime(),clearTimeout(e.timeoutId),e.onCall()}),this.$bus.$on("isCalling",function(t){e.alreadyCalling(t)}),this.$bus.$on("onClose",function(){e.closeFlag=!0,wx.navigateBack({delta:1})}),this.$bus.$on("onRefuse",function(){e.closeFlag=!0,wx.navigateBack({delta:1})}),this.$bus.$on("onBusy",function(){e.closeFlag=!0,wx.navigateBack({delta:1})})},methods:{onRoomEvent:function(t){if([c,l,m,u,d,h,g].includes(t.target.code)){this.webrtcroomComponent=this.$mp.page.selectComponent("#webrtcroom"),this.webrtcroomComponent.stop(),this.args.action=-2,this.args.code=t.target.code;var e=(0,i.default)(this.args),s=this.to===this.$store.getters.myInfo.userID?this.from:this.to,o=wx.$app.createCustomMessage({to:s,conversationType:a.default.CONV_C2C,payload:{data:e,description:"",extension:""}});this.$store.commit("sendMessage",o),wx.$app.sendMessage(o),clearTimeout(this.timeoutId)}"error"===t.target.tag&&wx.showToast({title:t.target.detail,duration:1e3})},handleCloseRoom:function(){this.closeFlag=!0,this.closeRoom(),wx.navigateBack({delta:1})},handleRefuse:function(){this.refuseFlag=!0,this.refuse(),wx.navigateBack({delta:1})},closeRoom:function(){if(this.webrtcroomComponent=this.$mp.page.selectComponent("#webrtcroom"),this.webrtcroomComponent.stop(),this.args.action=5,0===this.startTime&&(this.args.action=1),0!==this.startTime){var t=(new Date).getTime();this.args.duration=Math.round((t-this.startTime)/1e3),this.startTime=0}var e=(0,i.default)(this.args),s=this.to===this.$store.getters.myInfo.userID?this.from:this.to,o=wx.$app.createCustomMessage({to:s,conversationType:a.default.CONV_C2C,payload:{data:e,description:"",extension:""}});this.$store.commit("sendMessage",o),wx.$app.sendMessage(o),clearTimeout(this.timeoutId)},timeout:function(){this.args.action=3;var t=(0,i.default)(this.args),e=wx.$app.createCustomMessage({to:this.to,conversationType:a.default.CONV_C2C,payload:{data:t,description:"",extension:""}});this.$store.commit("sendMessage",e),wx.$app.sendMessage(e),wx.navigateBack({delta:1})},receive:function(){this.args.action=4;var t=(0,i.default)(this.args);this.startTime=(new Date).getTime();var e=wx.$app.createCustomMessage({to:this.from,conversationType:a.default.CONV_C2C,payload:{data:t,description:"",extension:""}});this.$store.commit("sendMessage",e),wx.$app.sendMessage(e),clearTimeout(this.timeoutId),this.isCalling=!0,this.isPending=!1,this.webrtcroomComponent=this.$mp.page.selectComponent("#webrtcroom"),this.webrtcroomComponent.start()},onCall:function(){this.webrtcroomComponent=this.$mp.page.selectComponent("#webrtcroom"),this.webrtcroomComponent.start()},refuse:function(){this.args.action=2;var t=(0,i.default)(this.args),e=wx.$app.createCustomMessage({to:this.from,conversationType:a.default.CONV_C2C,payload:{data:t,description:"",extension:""}});this.$store.commit("sendMessage",e),this.$store.commit("setCalling",!1),wx.$app.sendMessage(e),clearTimeout(this.timeoutId)},alreadyCalling:function(t){var e=JSON.parse(t.payload.data);e.action=6;var s=wx.$app.createCustomMessage({to:t.from,conversationType:a.default.CONV_C2C,payload:{data:(0,i.default)(e),description:"",extension:""}});this.$store.commit("sendMessage",s),wx.$app.sendMessage(s)},microphone:function(){this.muted=!this.muted},monitor:function(){this.webrtcroomComponent=this.$mp.page.selectComponent("#webrtcroom"),this.webrtcroomComponent.switchCamera()}},destory:function(){}}},VzEx:function(t,e,s){"use strict";var i={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bg-logo"},[s("div",{staticClass:"bg"},[t.isCalling?t._e():s("div",{staticClass:"choose"},["call"===t.type?[s("div",{staticClass:"title"},[t._v("呼叫"+t._s(t.to)+"中")]),t._v(" "),s("div",{staticClass:"btn"},[s("div",{staticClass:"close",attrs:{eventid:"0"},on:{click:t.handleCloseRoom}},[s("image",{staticClass:"operation",attrs:{src:"/static/images/close.png"}})])])]:t._e(),t._v(" "),"onCall"===t.type?[s("div",{staticClass:"title"},[t._v(t._s(t.from)+"正在呼叫")]),t._v(" "),s("div",{staticClass:"btn"},[s("div",{staticClass:"close answer",attrs:{eventid:"1"},on:{click:t.receive}},[s("image",{staticClass:"operation",attrs:{src:"/static/images/call.png"}})]),t._v(" "),s("div",{staticClass:"close",attrs:{eventid:"2"},on:{click:t.handleRefuse}},[s("image",{staticClass:"operation",attrs:{src:"/static/images/close.png"}})])])]:t._e()],2),t._v(" "),s("div",{staticClass:"call",style:t.isCalling?{display:"flex",height:"100vh",width:"100vw"}:{display:"none"}},[s("div",{staticClass:"room"},[s("webrtc-room",{attrs:{id:"webrtcroom",autoplay:!0,enableCamera:!0,roomID:t.roomID,userID:t.userID,userSig:t.userSig,sdkAppID:t.sdkAppID,beauty:t.beauty,muted:t.muted,smallViewLeft:"calc(100vw - 30vw - 2vw)",smallViewTop:"20vw",smallViewWidth:"30vw",smallViewHeight:"30vh",eventid:"3",mpcomid:"2"},on:{RoomEvent:t.onRoomEvent}}),t._v(" "),s("div",{staticClass:"panel"},[s("div",{staticClass:"close-btn"},[s("div",{staticClass:"normal",attrs:{eventid:"4"},on:{click:t.microphone}},[t.muted?s("image",{staticClass:"operation",attrs:{src:"/static/images/voice-muted.png"}}):s("image",{staticClass:"operation",attrs:{src:"/static/images/voice.png"}})]),t._v(" "),s("div",{staticClass:"close",attrs:{eventid:"5"},on:{click:t.handleCloseRoom}},[s("image",{staticClass:"operation",attrs:{src:"/static/images/close.png"}})]),t._v(" "),s("div",{staticClass:"normal",attrs:{eventid:"6"},on:{click:t.monitor}},[s("image",{staticClass:"operation",attrs:{src:"/static/images/monitor.png"}})])])])],1)])])])},staticRenderFns:[]};e.a=i},yL8p:function(t,e){}},["Bc9Z"]);