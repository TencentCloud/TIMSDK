require("../../common/manifest.js")
require("../../debug/GenerateTestUserSig.js")
require("../../common/vendor.js")
global.webpackJsonpMpvue([2],{"2gy9":function(t,a,n){"use strict";var i=n("Xxa5"),e=n.n(i),s=n("exGp"),o=n.n(s),r=n("Dd8w"),l=n.n(r),c=n("Gu7T"),u=n.n(c),v=n("NYxO"),h=n("Ho+G"),g=n.n(h);a.a={name:"calling",data:function(){return{action:"",callingFlag:!1,pusherAvatar:"",invitee:{},inviter:{},invitation:{},incomingCallFlag:!1,inviteCallFlag:!1,config:{sdkAppID:"",userID:"",userSig:"",type:0},defaultAvatar:g.a,userIDList:[],avatarList:[],groupID:""}},created:function(){var t=this.rtcConfig,a=t.sdkAppID,n=t.userID,i=t.userSig;this.config={sdkAppID:a,userID:n,userSig:i,type:0}},onShow:function(){console.warn("callData---\x3eshow",this.callData);var t=this.callData,a=t.action,n=t.sponsor,i=t.to,e=t.userIDList,s=t.inviteData;if(a)switch(this.setCallingUserInfo(),this.config.type=s.callType,this.userIDList=[].concat(u()(e)),a){case"call":this.callingFlag=!0,this.inviteCallFlag=!0,this.action=a,this.$parent.hideChatContainer(),this.call();break;case"groupCall":this.callingFlag=!0,this.inviteCallFlag=!0,this.action=a,this.groupID=i,this.$parent.hideChatContainer(),this.groupCall();break;case"invited":this.invitation=l()({inviter:n},s),this.incomingCallFlag=!0,this.$parent.hideChatContainer()}},mounted:function(){var t=this;this.$bus.$on("user-enter",function(a){var n=a.inviteCallFlag,i=void 0!==n&&n;t.inviteCallFlag=i}),this.$bus.$on("call-reject",function(a){var n=a.callingFlag,i=void 0!==n&&n;t.callingFlag=i,t.$parent.showChatContainer(),t.$store.commit("setCallData",{action:"",data:{}}),t.onBack()}),this.$bus.$on("call-cancel",function(a){var n=a.incomingCallFlag,i=void 0!==n&&n;t.incomingCallFlag=i,t.$parent.showChatContainer(),t.$store.commit("setCallData",{action:"",data:{}}),t.onBack()}),this.$bus.$on("call-end",function(a){var n=a.callingFlag,i=void 0!==n&&n,e=a.incomingCallFlag,s=void 0!==e&&e;t.callingFlag=i,t.incomingCallFlag=s,t.$parent.showChatContainer(),t.$store.commit("setCallData",{action:"",data:{}}),t.onBack()}),this.$bus.$on("line-busy",function(a){var n=a.callingFlag,i=void 0!==n&&n,e=a.incomingCallFlag,s=void 0!==e&&e;t.callingFlag=i,t.incomingCallFlag=s,t.$parent.showChatContainer(),t.$store.commit("setCallData",{action:"",data:{}}),t.onBack()})},onUnload:function(){console.warn("component start to destroy"),this.$bus.$off("user-enter"),this.$bus.$off("call-reject"),this.$bus.$off("call-cancel"),this.$bus.$off("call-end"),this.$bus.$off("no-resp"),this.$bus.$off("line-busy"),this.$bus.$off("call-timeout")},computed:l()({},Object(v.c)({rtcConfig:function(t){return t.global.rtcConfig},callData:function(t){return t.global.callData},currentPage:function(t){return t.global.currentPage},myInfo:function(t){return t.user.myInfo}})),methods:{setCallingUserInfo:function(){var t=this.callData,a=t.action,n=t.sponsor,i=t.to,e=t.avatarList,s=void 0===e?{}:e;console.warn("avatarList--calling",s),this.avatarList=l()({},s),"call"===a&&(this.inviter.userID=n,this.pusherAvatar=this.myInfo.avatar||this.defaultAvatar,this.inviter.avatar="",this.invitee.userID=i,this.invitee.avatar=s[this.invitee.userID]),"groupCall"===a&&(this.inviter.userID=n,this.pusherAvatar=this.myInfo.avatar||this.defaultAvatar,this.inviter.avatar="",this.invitee.userID=i,this.invitee.avatar=this.defaultAvatar),"invited"===a&&(this.inviter.userID=n,this.pusherAvatar=this.myInfo.avatar||this.defaultAvatar,this.inviter.avatar=s[this.inviter.userID],this.invitee.userID=this.myInfo.userID,this.invitee.avatar="")},call:function(){var t=this;return o()(e.a.mark(function a(){var n;return e.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,wx.$TRTCCallingComponent.call({userID:t.invitee.userID,type:t.config.type});case 2:n=a.sent,t.$store.commit("sendMessage",n);case 4:case"end":return a.stop()}},a,t)}))()},groupCall:function(){var t=this;return o()(e.a.mark(function a(){var n;return e.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,wx.$TRTCCallingComponent.groupCall({groupID:t.groupID,userIDList:t.userIDList,type:t.config.type});case 2:n=a.sent,t.$store.commit("sendMessage",n);case 4:case"end":return a.stop()}},a,t)}))()},handleOnAccept:function(){var t=this;return o()(e.a.mark(function a(){var n;return e.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.callingFlag=!0,t.incomingCallFlag=!1,a.next=4,wx.$TRTCCallingComponent.accept();case 4:n=a.sent,t.$store.commit("sendMessage",n);case 6:case"end":return a.stop()}},a,t)}))()},handleOnReject:function(){var t=this;return o()(e.a.mark(function a(){var n;return e.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,wx.$TRTCCallingComponent.reject();case 2:n=a.sent,t.$store.commit("sendMessage",n),console.warn("handleOnReject---\x3e",n),t.incomingCallFlag=!1,t.$parent.showChatContainer(),t.$store.commit("setCallData",{action:"",data:{}}),t.onBack();case 9:case"end":return a.stop()}},a,t)}))()},handleOnCancel:function(){var t=this;return o()(e.a.mark(function a(){return e.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:wx.$TRTCCallingComponent.hangup();case 1:case"end":return t.stop()}},a,t)}))()},handleInvited:function(){console.warn("handleInvited----------\x3e");var t=this.callData,a=t.sponsor,n=t.inviteData;this.setCallingUserInfo(),this.invitation=l()({inviter:a},n),this.incomingCallFlag=!0},onBack:function(){this.$store.getters.isCalling&&(this.$store.commit("setCalling",!1),-1===this.currentPage.indexOf("?")&&(this.currentPage.indexOf("index")>-1||this.currentPage.indexOf("contact")>-1||this.currentPage.indexOf("own")>-1)?wx.switchTab({url:this.currentPage}):wx.navigateTo({url:this.currentPage}))}}}},"5vTQ":function(t,a,n){"use strict";var i=n("Dd8w"),e=n.n(i),s=n("NYxO"),o=n("YXvm"),r=n("0xDb");a.a={data:function(){return{TRTCCallingComponent:null,modalVisible:!1,conversation:{},isShowChatContainer:!0}},computed:e()({},Object(s.c)({allConversation:function(t){return t.conversation.allConversation},isSdkReady:function(t){return t.global.isSdkReady},isCalling:function(t){return t.global.isCalling},initTRTCCalling:function(t){return t.global.initTRTCCalling},currentPage:function(t){return t.global.currentPage}}),Object(s.b)(["totalUnreadCount","myInfo"])),onPullDownRefresh:function(){Object(r.e)(wx.$app.getConversationList(),1e3),wx.stopPullDownRefresh()},created:function(){},mounted:function(){this.initTRTCCalling&&(wx.$TRTCCallingComponent=this.$mp.page.selectComponent("#TRTCCalling-component"),this.$bindTRTCCallingRoomEvent(wx.$TRTCCallingComponent),wx.$TRTCCallingComponent.login(),this.$store.commit("setInitTRTCCalling",!1))},components:{Calling:o.a},methods:{messageAtMeText:function(){this.allConversation.forEach(function(t){var a="";Array.isArray(t.groupAtInfoList)&&t.groupAtInfoList.length>0&&(t.groupAtInfoList.forEach(function(t){t.atTypeArray[0]===wx.TIM.TYPES.CONV_AT_ME&&(a=-1!==a.indexOf("[@所有人]")?"[@所有人][有人@我]":"[有人@我]"),t.atTypeArray[0]===wx.TIM.TYPES.CONV_AT_ALL&&(a=-1!==a.indexOf("[有人@我]")?"[有人@我][@所有人]":"[@所有人]"),t.atTypeArray[0]===wx.TIM.TYPES.CONV_AT_ALL_AT_ME&&(a="[@所有人][有人@我]")}),t.messageAt_Text=a)})},longTimePress:function(t){this.conversation=t,this.handleModalShow()},handleModalShow:function(){this.modalVisible=!this.modalVisible},handleConfirm:function(){this.handleModalShow(),this.deleteConversation(this.conversation)},setMessageRead:function(t){0!==t.unreadCount&&wx.$app.setMessageRead({conversationID:t.conversationID})},checkoutConversation:function(t,a){this.$store.dispatch("checkoutConversation",t.conversationID)},checkoutNotification:function(t){var a=this;this.$store.commit("resetCurrentConversation"),this.$store.commit("resetGroup"),this.setMessageRead(t),wx.$app.getConversationProfile(t.conversationID).then(function(t){a.$store.commit("updateCurrentConversation",t.data.conversation),a.$store.dispatch("getMessageList")});wx.navigateTo({url:"../system/main"})},deleteConversation:function(t){wx.$app.deleteConversation(t.conversationID).then(function(t){console.log("delete success",t)})},empty:function(){wx.navigateTo({url:"../search/main"})},showChatContainer:function(){this.isShowChatContainer=!0},hideChatContainer:function(){this.isShowChatContainer=!1},updatePageInfo:function(t){t?(wx.setNavigationBarTitle({title:""}),wx.hideTabBar()):(wx.setNavigationBarTitle({title:"消息"}),wx.showTabBar())}},onLoad:function(){this.isSdkReady||wx.showLoading({title:"正在同步数据",mask:!0})},onShow:function(){wx.setKeepScreenOn({keepScreenOn:!0}),this.updatePageInfo(this.isCalling)},watch:{isSdkReady:function(t){t&&wx.hideLoading()},allConversation:function(t){t&&this.messageAtMeText(t)},isCalling:function(t){"/pages/index/main"===this.currentPage&&(t&&(this.hideChatContainer(),this.$refs.callingDom.handleInvited()),this.updatePageInfo(t))}}}},"7M6s":function(t,a,n){"use strict";var i={render:function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.callingFlag,expression:"callingFlag"}],staticClass:"calling-container"},[n("trtc-calling",{staticClass:"calling-component",attrs:{id:"TRTCCalling-component",config:t.config,pusherAvatar:t.pusherAvatar,avatarList:t.avatarList,mpcomid:"0"}}),t._v(" "),t.incomingCallFlag?n("div",{staticClass:"incoming-call"},[n("img",{attrs:{src:t.inviter.avatar}}),t._v(" "),n("div",{staticClass:"tips"},[t._v(t._s(t.invitation.inviter))]),t._v(" "),n("div",{staticClass:"tips"},[t._v(t._s("邀请你"+(1===t.invitation.callType?"语音":"视频")+"通话"))]),t._v(" "),n("div",{staticClass:"btn-operate"},[n("div",{staticClass:"call-operate",staticStyle:{"background-color":"red"},attrs:{eventid:"0"},on:{click:t.handleOnReject}},[n("img",{attrs:{src:"../../static/images/hangup.png"}})]),t._v(" "),n("div",{staticClass:"call-operate",staticStyle:{"background-color":"#07c160"},attrs:{eventid:"1"},on:{click:t.handleOnAccept}},[n("img",{staticStyle:{transform:"rotate(-135deg)"},attrs:{src:"../../static/images/hangup.png"}})])])]):t._e(),t._v(" "),t.inviteCallFlag?n("div",{staticClass:"invite-call"},[n("img",{attrs:{src:t.invitee.avatar}}),t._v(" "),"call"===t.action?n("div",{staticClass:"tips"},[t._v(t._s("等待"+t.invitee.userID+"接受邀请"))]):t._e(),t._v(" "),"groupCall"===t.action?n("div",{staticClass:"tips"},[t._v(t._s("正在发起通话"))]):t._e(),t._v(" "),n("div",{staticClass:"btn-operate"},[n("div",{staticClass:"call-operate",staticStyle:{"background-color":"red"},attrs:{eventid:"2"},on:{click:t.handleOnCancel}},[n("img",{attrs:{src:"../../static/images/hangup.png"}})])])]):t._e()],1)},staticRenderFns:[]};a.a=i},DiJR:function(t,a){},MhDc:function(t,a,n){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=n("5nAL"),e=n.n(i),s=n("Qt9A");e.a.config.errorHandler=function(t){console&&console.error&&console.error(t)},new e.a(s.a).$mount()},Qt9A:function(t,a,n){"use strict";var i=n("5vTQ"),e=n("nlVh");var s=function(t){n("DiJR")},o=n("ybqe")(i.a,e.a,s,null,null);a.a=o.exports},YXvm:function(t,a,n){"use strict";var i=n("2gy9"),e=n("7M6s");var s=function(t){n("zk81")},o=n("ybqe")(i.a,e.a,s,"data-v-393548cf",null);a.a=o.exports},nlVh:function(t,a,n){"use strict";var i={render:function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("div",[n("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowChatContainer,expression:"isShowChatContainer "}],staticClass:"chat-container"},[0===t.allConversation.length?n("div",{staticClass:"empty"},[n("button",{staticClass:"empty-button",attrs:{type:"button",eventid:"0"},on:{click:t.empty}},[t._v("\n        发起一段对话吧\n      ")])],1):t._e(),t._v(" "),n("i-modal",{attrs:{title:"确认删除会话？",visible:t.modalVisible,eventid:"1",mpcomid:"0"},on:{ok:function(a){t.handleConfirm()},cancel:t.handleModalShow}}),t._v(" "),t._l(t.allConversation,function(a,i){return["C2C"===a.type?n("div",{key:a.conversationID,staticClass:"chat",attrs:{eventid:"4_"+i},on:{longpress:function(n){t.longTimePress(a)},click:function(n){t.checkoutConversation(a,a.userProfile.nick||a.userProfile.userID)}}},[n("div",{staticClass:"avatar-container"},[n("i-avatar",{attrs:{src:a.userProfile.avatar||"/static/images/avatar.png","i-class":"avatar",mpcomid:"1_"+i}})],1),t._v(" "),n("div",{staticClass:"right"},[n("div",{staticClass:"information"},[n("div",{staticClass:"username"},[t._v(t._s(a.userProfile.nick||a.userProfile.userID))]),t._v(" "),a.lastMessage.isRevoked?n("div",{staticClass:"content"},[t.myInfo.userID===a.lastMessage.fromAccount?[t._v("你撤回了一条消息")]:[t._v(t._s(a.lastMessage.fromAccount)+"撤回了一条消息")]],2):n("div",{staticClass:"content"},[t._v(t._s(a.lastMessage.messageForShow))])]),t._v(" "),n("div",{staticClass:"time"},[n("div",{staticClass:"last"},[t._v(t._s(a.lastMessage._lastTime))]),t._v(" "),a.unreadCount>0?n("div",{staticClass:"remain"},[a.unreadCount>99?n("span",{staticClass:"info"},[t._v("99+")]):n("span",{staticClass:"info"},[t._v(t._s(a.unreadCount))])]):t._e()])])]):"GROUP"===a.type?n("div",{key:a.conversationID,staticClass:"chat",attrs:{eventid:"2_"+i},on:{click:function(n){t.checkoutConversation(a,a.groupProfile.name||a.groupProfile.ID)},longpress:function(n){t.longTimePress(a)}}},[n("div",{staticClass:"avatar-container"},[n("i-avatar",{attrs:{src:a.groupProfile.avatar,"i-class":"avatar",mpcomid:"4_"+i}})],1),t._v(" "),n("div",{staticClass:"right"},[n("div",{staticClass:"information"},[n("div",{staticClass:"username"},[t._v(t._s(a.groupProfile.name||a.groupProfile.groupID))]),t._v(" "),a.lastMessage.isRevoked?n("div",{staticClass:"content"},[t.myInfo.userID===a.lastMessage.fromAccount?[t._v("你撤回了一条消息")]:[t._v(t._s(a.lastMessage.fromAccount)+"撤回了一条消息")]],2):n("div",{staticClass:"content"},["@TIM#SYSTEM"===a.lastMessage.fromAccount?n("div",[t._v(t._s(a.lastMessage.messageForShow))]):n("div",[a.groupAtInfoList.length>0?n("span",{staticClass:"remind",staticStyle:{color:"red"}},[t._v(t._s(a.messageAt_Text))]):t._e(),t._v("\n                "+t._s(a.lastMessage.fromAccount)+"："+t._s(a.lastMessage.messageForShow)+"\n              ")])])]),t._v(" "),n("div",{staticClass:"time"},[n("div",{staticClass:"last"},[t._v(t._s(a.lastMessage._lastTime))]),t._v(" "),a.unreadCount>0?n("div",{staticClass:"remain"},[a.unreadCount>99?n("span",{staticClass:"info"},[t._v("99+")]):n("span",{staticClass:"info"},[t._v(t._s(a.unreadCount))])]):t._e()])])]):"@TIM#SYSTEM"===a.type?n("div",{key:a.conversationID,staticClass:"chat",attrs:{eventid:"3_"+i},on:{click:function(n){t.checkoutNotification(a)},longpress:function(n){t.longTimePress(a)}}},[t._m(0,!0),t._v(" "),n("div",{staticClass:"right"},[t._m(1,!0),t._v(" "),n("div",{staticClass:"time"},[n("div",{staticClass:"last"}),t._v(" "),a.unreadCount>0?n("div",{staticClass:"remain"},[a.unreadCount>99?n("span",{staticClass:"info"},[t._v("99+")]):n("span",{staticClass:"info"},[t._v(t._s(a.unreadCount))])]):t._e()])])]):t._e()]})],2),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:!t.isShowChatContainer,expression:"!isShowChatContainer"}]},[n("Calling",{ref:"callingDom",attrs:{mpcomid:"8"}})],1)])},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"avatar-container"},[a("image",{staticClass:"avatar",attrs:{src:"/static/images/system.png"}})])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"information"},[a("div",{staticClass:"username"},[this._v("系统通知")]),this._v(" "),a("div",{staticClass:"content"},[this._v("点击查看")])])}]};a.a=i},zk81:function(t,a){}},["MhDc"]);